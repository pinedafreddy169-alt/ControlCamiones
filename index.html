<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Control de Camiones - Login</title>
  <style>
    body{font-family:Arial, sans-serif;background:#0b1220;color:#fff;margin:0;min-height:100vh;display:grid;place-items:center}
    .card{background:#121a2b;padding:22px;border-radius:14px;width:min(92vw,360px);border:1px solid #23314f}
    h2{text-align:center;margin:6px 0 14px}
    input{width:100%;padding:12px;margin:8px 0;border:1px solid #23314f;border-radius:10px;background:#0f1526;color:#fff}
    button{width:100%;padding:12px;border:none;border-radius:10px;cursor:pointer;margin-top:10px;font-weight:700}
    .btn-login{background:#27c380;color:#0b281c}
    .btn-register{background:#3fa0ff;color:#04101f}
    .toggle{margin-top:12px;text-align:center;font-size:14px;color:#9ba8bf;cursor:pointer}
    .msg{min-height:20px;text-align:center;margin-top:8px}
    .ok{color:#27c380}.err{color:#ff7b7b}
  </style>
</head>
<body>
  <div class="card">
    <h2 id="title">Iniciar sesión</h2>
    <input type="text" id="user" placeholder="Usuario" autocomplete="username"/>
    <input type="password" id="pass" placeholder="Contraseña" autocomplete="current-password"/>
    <button class="btn-login" id="btnLogin">Entrar</button>
    <button class="btn-register" id="btnRegister" style="display:none">Registrar</button>
    <div class="toggle" id="toggleForm">¿No tienes cuenta? Registrar</div>
    <div class="msg" id="msg"></div>
  </div>

  <script>
    // Si ya hay sesión iniciada, ir directo a la app
    if(localStorage.getItem('session_user')) location.href = 'app.html';

    const $ = sel => document.querySelector(sel);
    const msg = $('#msg');
    let isRegister = false;

    function getUsers(){ return JSON.parse(localStorage.getItem('usuarios')||'[]'); }
    function saveUsers(u){ localStorage.setItem('usuarios', JSON.stringify(u)); }

    // Toggle login/registro
    $('#toggleForm').addEventListener('click', ()=>{
      isRegister = !isRegister;
      $('#title').textContent = isRegister ? 'Registrar usuario' : 'Iniciar sesión';
      $('#btnLogin').style.display    = isRegister ? 'none'  : 'block';
      $('#btnRegister').style.display = isRegister ? 'block' : 'none';
      $('#toggleForm').textContent    = isRegister ? '¿Ya tienes cuenta? Iniciar sesión' : '¿No tienes cuenta? Registrar';
      msg.textContent = ''; msg.className='msg';
    });

    // Entrar
    $('#btnLogin').addEventListener('click', ()=>{
      const u = $('#user').value.trim();
      const p = $('#pass').value.trim();
      if(!u || !p){ msg.textContent='Completa los campos'; msg.className='msg err'; return; }
      const users = getUsers();
      const ok = users.find(x=>x.user===u && x.pass===p);
      if(ok){
        localStorage.setItem('session_user', u);
        msg.textContent='Acceso correcto ✔'; msg.className='msg ok';
        location.href = 'app.html';
      }else{
        msg.textContent='Usuario o contraseña incorrectos'; msg.className='msg err';
      }
    });

    // Registrar
    $('#btnRegister').addEventListener('click', ()=>{
      const u = $('#user').value.trim();
      const p = $('#pass').value.trim();
      if(!u || !p){ msg.textContent='Completa los campos'; msg.className='msg err'; return; }
      const users = getUsers();
      if(users.some(x=>x.user===u)){ msg.textContent='Ese usuario ya existe'; msg.className='msg err'; return; }
      users.push({user:u, pass:p}); saveUsers(users);
      msg.textContent='Usuario registrado ✔'; msg.className='msg ok';
      isRegister=false;
      $('#title').textContent='Iniciar sesión';
      $('#btnLogin').style.display='block';
      $('#btnRegister').style.display='none';
      $('#toggleForm').textContent='¿No tienes cuenta? Registrar';
    });

    // Atajo Enter
    document.addEventListener('keydown', e=>{
      if(e.key==='Enter'){
        if(isRegister) $('#btnRegister').click();
        else $('#btnLogin').click();
      }
    });
  </script>
</body>
</html>
