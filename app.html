<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Control de Camiones</title>
  <style>
    body { background:#111; color:#eee; font-family:Arial; padding:20px; }
    h1 { color:#f55; }
    label { display:block; margin-top:10px; }
    input, select, textarea { width:100%; padding:5px; margin-top:3px; }
    button { margin:10px 5px; padding:10px 15px; }
  </style>
</head>
<body>
  <h1>üöõ Control de Camiones</h1>

  <form id="formRegistro">
    <label>Fecha <input type="date" id="fecha"></label>
    <label>Cami√≥n <input type="text" id="camion"></label>
    <label>Placa <input type="text" id="placa"></label>
    <label>Chofer <input type="text" id="chofer"></label>
    <label>Origen <input type="text" id="origen"></label>
    <label>Destino <input type="text" id="destino"></label>
    <label>Salida <input type="time" id="salida"></label>
    <label>Llegada <input type="time" id="llegada"></label>
    <label>Observaciones <textarea id="observaciones"></textarea></label>

    <button type="button" onclick="guardarLocal()">Guardar</button>
    <button type="button" onclick="sincronizar()">Sincronizar</button>
    <button type="reset">Limpiar</button>
  </form>

  <h2>üìã Registros locales</h2>
  <div id="lista"></div>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbz-jQF8M0DEWy-z6l4uxFcjq_l964ZR77AP-jJeWtwSKKMN444GZ6hBmDjRY2HI4zN6lw/exec";
const STORAGE_KEY = "camiones_registros";

function leer() { return JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]"); }
function guardar(arr) { localStorage.setItem(STORAGE_KEY, JSON.stringify(arr)); }
function render() {
  const lista = leer();
  document.getElementById("lista").innerHTML = lista.map((r,i)=>
    `<div>(${i+1}) ${r.fecha} - ${r.camion} - ${r.chofer} ‚Üí ${r.destino}</div>`
  ).join("");
}

function guardarLocal() {
  const r = {
    fecha: document.getElementById("fecha").value,
    camion: document.getElementById("camion").value,
    placa: document.getElementById("placa").value,
    chofer: document.getElementById("chofer").value,
    origen: document.getElementById("origen").value,
    destino: document.getElementById("destino").value,
    salida: document.getElementById("salida").value,
    llegada: document.getElementById("llegada").value,
    observaciones: document.getElementById("observaciones").value
  };
  const lista = leer();
  lista.push(r);
  guardar(lista);
  render();
  alert("‚úÖ Registro guardado localmente.");
}

async function sincronizar() {
  const registros = leer();
  if (!registros.length) { alert("No hay registros."); return; }

  const params = new URLSearchParams();
  params.append("payload", JSON.stringify(registros));

  try {
    const resp = await fetch(SCRIPT_URL, { method:"POST", body:params });
    if (resp.ok) {
      localStorage.removeItem(STORAGE_KEY);
      render();
      alert("üöÄ Sincronizaci√≥n completada.");
    } else {
      alert("‚ùå Error HTTP " + resp.status);
    }
  } catch(e) {
    alert("‚ö†Ô∏è Fall√≥ la sincronizaci√≥n: " + e.message);
  }
}

render();
</script>
</body>
</html>
