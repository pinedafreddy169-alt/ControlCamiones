<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Control de Camiones ‚Äì BYC</title>
  <style>
    body{font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif;background:#fff;max-width:900px;margin:0 auto;padding:20px}
    h1{font-size:1.8rem;margin-bottom:10px}
    p.lead{color:#555;margin-bottom:20px}
    form{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    label{font-size:.9rem;color:#222}
    input,select,textarea{width:100%;padding:10px;border:1px solid #ccc;border-radius:8px;font-size:1rem}
    textarea{grid-column:1/-1;min-height:80px}
    .row-2{grid-column:1/-1;display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .actions{grid-column:1/-1;display:flex;gap:12px;margin-top:10px;flex-wrap:wrap}
    button{padding:12px 16px;border:0;border-radius:10px;cursor:pointer;font-weight:600}
    .primary{background:#2b7cff;color:#fff}
    .ghost{background:#f2f2f2}
    .ok{color:#0a7c2b;font-weight:600}
    .error{color:#b00020;font-weight:600;white-space:pre-wrap}
    table{width:100%;border-collapse:collapse;margin-top:16px}
    th,td{border:1px solid #ddd;padding:6px;font-size:.9rem}
    th{background:#f5f5f5}
  </style>
</head>
<body>
  <h1>Control de Camiones</h1>
  <p class="lead">Registra viajes y sincroniza con la hoja <b>CHOFERES BYC</b>.</p>

  <!-- URL del script de Apps Script -->
  <script>
    const GAS_URL = "https://script.google.com/macros/s/AKfycbyjDY7j7ehoQ7crRAh2tLT_PnRvVT384_YmUmJ5JOmwP8jBH23x45CksGy3plcsM5nLcg/exec";
  </script>

  <!-- Listas de Fincas y Lotes -->
  <script>
    const FINCAS = ["Buena Vista","Guayabito","Ca√±o Blanco","Don Cuyo","Chorcha","Los Abuelos","Rescate","Pataste","Los √Ångeles"];
    const LOTES = ["Lote 001","Lote 002","Lote 003","Lote 004","Lote 007","Lote 009","Lote 011","Lote 014","Lote 015","Lote 016","Lote 017","Lote 021","Lote 027"];
  </script>

  <form id="frm">
    <div><label>Fecha</label><input type="date" name="fecha" required></div>
    <div><label>Cami√≥n</label><input type="text" name="camion" required></div>
    <div><label>Placa</label><input type="text" name="placa"></div>
    <div><label>Chofer</label><input type="text" name="chofer" required></div>
    <div><label>Origen</label><input type="text" name="origen"></div>
    <div><label>Destino</label><input type="text" name="destino"></div>

    <div><label>Finca</label>
      <input list="dlFincas" name="finca" placeholder="Selecciona o escribe">
      <datalist id="dlFincas"></datalist>
    </div>
    <div><label>Lote</label>
      <input list="dlLotes" name="lote" placeholder="Selecciona o escribe">
      <datalist id="dlLotes"></datalist>
    </div>

    <div class="row-2">
      <div><label>Hora salida</label><input type="time" name="salida"></div>
      <div><label>Hora llegada</label><input type="time" name="llegada"></div>
    </div>

    <textarea name="observaciones" placeholder="Observaciones"></textarea>

    <div class="actions">
      <button type="button" class="primary" id="btnEnviar">Enviar a Excel</button>
      <button type="reset" class="ghost">Limpiar</button>
      <button type="button" class="ghost" id="btnSync">üîÑ Sincronizar</button>
    </div>
  </form>

  <p id="msg"></p>
  <div id="tabla"></div>

  <script>
    const $ = s => document.querySelector(s);
    const msg = $("#msg");
    const tabla = $("#tabla");

    // llenar listas
    $("#dlFincas").innerHTML = FINCAS.map(f=>`<option value="${f}">`).join("");
    $("#dlLotes").innerHTML  = LOTES.map(l=>`<option value="${l}">`).join("");

    function leerFormulario(){
      const f = $("#frm");
      return {
        fecha:f.fecha.value,camion:f.camion.value,placa:f.placa.value,chofer:f.chofer.value,
        origen:f.origen.value,destino:f.destino.value,
        finca:f.finca.value,lote:f.lote.value,
        salida:f.salida.value,llegada:f.llegada.value,
        observaciones:f.observaciones.value
      };
    }

    async function enviar(){
      msg.textContent="Enviando...";
      try{
        const reg = leerFormulario();
        const body=new URLSearchParams({payload:JSON.stringify([reg])});
        const res=await fetch(GAS_URL,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body});
        const t=await res.text();let j;
        try{j=JSON.parse(t);}catch{j={ok:res.ok,raw:t};}
        if(j.ok){msg.innerHTML=`<span class="ok">‚úÖ Enviado (${j.insertados} fila)</span>`;$("#frm").reset();}
        else throw new Error(j.error||JSON.stringify(j));
      }catch(e){msg.innerHTML=`<span class="error">‚ùå ${e}</span>`;}
    }

    async function sincronizar(){
      msg.textContent="Sincronizando...";
      try{
        const res=await fetch(GAS_URL+"?action=getData");const j=await res.json();
        if(!j.ok) throw new Error(j.error||"Error sync");
        msg.innerHTML=`<span class="ok">‚úÖ Datos sincronizados (${j.data.length})</span>`;
        mostrarTabla(j.headers,j.data);
      }catch(e){msg.innerHTML=`<span class="error">‚ùå ${e}</span>`;}
    }

    function mostrarTabla(headers,data){
      if(!data.length){tabla.innerHTML="<p>No hay registros.</p>";return;}
      let html="<table><thead><tr>";
      headers.forEach(h=>html+=`<th>${h}</th>`);html+="</tr></thead><tbody>";
      data.forEach(r=>{html+="<tr>";headers.forEach(h=>html+=`<td>${r[h]??""}</td>`);html+="</tr>";});
      html+="</tbody></table>";tabla.innerHTML=html;
    }

    $("#btnEnviar").addEventListener("click",enviar);
    $("#btnSync").addEventListener("click",sincronizar);
  </script>
</body>
</html>
