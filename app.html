<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Control de Camiones ‚Äì BYC</title>
  <style>
    body{font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif;max-width:720px;margin:0 auto;padding:16px}
    h1{margin:0 0 12px}
    form{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    label{font-size:.9rem;color:#333}
    input,textarea{width:100%;padding:10px;border:1px solid #ccc;border-radius:10px;font-size:1rem}
    textarea{grid-column:1/-1;min-height:90px}
    .row-2{grid-column:1/-1;display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .actions{grid-column:1/-1;display:flex;gap:12px;margin-top:8px;flex-wrap:wrap}
    button{padding:12px 16px;border:0;border-radius:12px;cursor:pointer;font-weight:600;box-shadow:0 2px 8px rgba(0,0,0,.08)}
    .primary{background:#2b7cff;color:#fff}
    .ghost{background:#f2f2f2}
    .ok{color:#0a7c2b;font-weight:600}
    .error{color:#b00020;font-weight:600;white-space:pre-wrap}
    table{width:100%;border-collapse:collapse;margin-top:12px}
    th,td{border:1px solid #ddd;padding:8px;font-size:.95rem}
    th{background:#f6f6f6;text-align:left}
  </style>
</head>
<body>
  <h1>Control de Camiones</h1>
  <p>Completa y presion√° <b>Enviar a Excel</b>. Luego pod√©s usar <b>üîÑ Sincronizar</b> para ver lo guardado.</p>

  <!-- URL de tu script -->
  <script>
    const GAS_URL = "https://script.google.com/macros/s/AKfycbw-0PS8huGi_7VHS24rd6ywBajLoOAwJVVKUdxLMqOiDctqbn-kxeYhLNb-io2h3BaaiA/exec";
  </script>

  <form id="frm">
    <div><label>Fecha</label><input type="date" name="fecha" required /></div>
    <div><label>Cami√≥n</label><input type="text" name="camion" required /></div>
    <div><label>Placa</label><input type="text" name="placa" /></div>
    <div><label>Chofer</label><input type="text" name="chofer" required /></div>
    <div><label>Origen</label><input type="text" name="origen" /></div>
    <div><label>Destino</label><input type="text" name="destino" /></div>
    <div class="row-2">
      <div><label>Hora salida</label><input type="time" name="salida" /></div>
      <div><label>Hora llegada</label><input type="time" name="llegada" /></div>
    </div>
    <textarea name="observaciones" placeholder="Observaciones"></textarea>
    <div class="actions">
      <button type="button" class="primary" id="btnEnviar">Enviar a Excel</button>
      <button type="reset" class="ghost">Limpiar</button>
      <button type="button" class="ghost" id="btnSync">üîÑ Sincronizar</button>
    </div>
  </form>

  <p id="msg"></p>
  <div id="tabla"></div>

  <script>
    const $ = s => document.querySelector(s);
    const msg = $("#msg");
    const wrapTabla = $("#tabla");

    function leerFormulario() {
      const f = $("#frm");
      return {
        fecha: f.fecha.value,
        camion: f.camion.value,
        placa: f.placa.value,
        chofer: f.chofer.value,
        origen: f.origen.value,
        destino: f.destino.value,
        salida: f.salida.value,
        llegada: f.llegada.value,
        observaciones: f.observaciones.value
      };
    }

    async function enviar() {
      msg.textContent = "Enviando‚Ä¶";
      try {
        const registro = leerFormulario();
        const body = new URLSearchParams({ payload: JSON.stringify([registro]) });
        const res = await fetch(GAS_URL, {
          method: "POST",
          headers: {"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},
          body
        });
        const text = await res.text();
        let json;
        try { json = JSON.parse(text); } catch { json = {ok: res.ok, raw: text}; }
        if (json.ok) {
          msg.innerHTML = `<span class="ok">‚úÖ Enviado. Filas insertadas: ${json.insertados ?? 1}</span>`;
          $("#frm").reset();
        } else {
          throw new Error(json.error || JSON.stringify(json));
        }
      } catch (e) {
        msg.innerHTML = `<span class="error">‚ùå Error:\n${String(e)}</span>`;
      }
    }

    async function sincronizar() {
      msg.textContent = "Sincronizando...";
      try {
        const res = await fetch(GAS_URL + "?action=getData");
        const json = await res.json();
        if (!json.ok) throw new Error(json.error || "Error al sincronizar");
        msg.innerHTML = `<span class="ok">‚úÖ Datos sincronizados (${json.data.length})</span>`;
        mostrarTabla(json.data);
      } catch (e) {
        msg.innerHTML = `<span class="error">‚ùå Error:\n${String(e)}</span>`;
      }
    }

    function mostrarTabla(data) {
      if (!data || !data.length) {
        wrapTabla.innerHTML = "<p>No hay datos registrados.</p>";
        return;
      }
      const cols = Object.keys(data[0]);
      let html = "<table><thead><tr>";
      cols.forEach(c => html += `<th>${c}</th>`);
      html += "</tr></thead><tbody>";
      data.forEach(row => {
        html += "<tr>";
        cols.forEach(c => html += `<td>${row[c] ?? ""}</td>`);
        html += "</tr>";
      });
      html += "</tbody></table>";
      wrapTabla.innerHTML = html;
    }

    $("#btnEnviar").addEventListener("click", enviar);
    $("#btnSync").addEventListener("click", sincronizar);
  </script>
</body>
</html>
