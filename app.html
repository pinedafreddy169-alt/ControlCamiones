<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Control de Camiones</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      background: #111;
      color: #eee;
      font-family: Arial, sans-serif;
      margin: 0; padding: 20px;
    }
    h1 { color: #f55; text-align: center; }
    label { display:block; margin-top:12px; font-weight:bold; }
    input, select, textarea {
      width: 100%; padding: 12px; margin-top: 5px;
      border-radius: 8px; border: none; font-size: 16px;
    }
    textarea { resize: vertical; }
    .botones { text-align: center; margin-top: 20px; }
    button {
      background: #f55; border:none; border-radius:10px;
      padding: 15px 25px; margin: 8px; font-size:16px; font-weight:bold;
      color:#fff; cursor:pointer;
    }
    button:active { background:#d44; }
    #lista { margin-top:20px; font-size:15px; }
    .registro { padding:8px; margin:5px 0; background:#222; border-radius:6px; }
  </style>
</head>
<body>
  <h1>🚛 Control de Camiones</h1>

  <form id="formRegistro">
    <label>📅 Fecha <input type="date" id="fecha"></label>
    <label>🚚 Camión <input type="text" id="camion" placeholder="Camión 01"></label>
    <label>🔖 Placa <input type="text" id="placa" placeholder="ABC-123"></label>
    <label>👨‍✈️ Chofer <input type="text" id="chofer" placeholder="Nombre chofer"></label>
    <label>🏭 Origen <input type="text" id="origen"></label>
    <label>🏡 Destino <input type="text" id="destino"></label>
    <label>⏰ Salida <input type="time" id="salida"></label>
    <label>⏱ Llegada <input type="time" id="llegada"></label>
    <label>📝 Observaciones <textarea id="observaciones"></textarea></label>
  </form>

  <div class="botones">
    <button type="button" onclick="guardarLocal()">💾 Guardar</button>
    <button type="button" onclick="sincronizar()">🔄 Sincronizar</button>
    <button type="reset" form="formRegistro">🧹 Limpiar</button>
  </div>

  <h2>📋 Registros locales</h2>
  <div id="lista"></div>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbx-N1v3hc4Gumo3ZH_vBQ_mm_03i8n-llBJ31urziJgLV6-Qc8kBEy5m5AjOsccBTRGtw/exec";
const STORAGE_KEY = "camiones_registros";

function leer() { return JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]"); }
function guardar(arr) { localStorage.setItem(STORAGE_KEY, JSON.stringify(arr)); }
function render() {
  const lista = leer();
  document.getElementById("lista").innerHTML = lista.map((r,i)=>
    `<div class="registro">(${i+1}) ${r.fecha} - ${r.camion} - ${r.chofer} → ${r.destino}</div>`
  ).join("");
}

function guardarLocal() {
  const r = {
    fecha: document.getElementById("fecha").value,
    camion: document.getElementById("camion").value,
    placa: document.getElementById("placa").value,
    chofer: document.getElementById("chofer").value,
    origen: document.getElementById("origen").value,
    destino: document.getElementById("destino").value,
    salida: document.getElementById("salida").value,
    llegada: document.getElementById("llegada").value,
    observaciones: document.getElementById("observaciones").value
  };
  if(!r.fecha || !r.camion || !r.chofer){ alert("⚠️ Fecha, Camión y Chofer son obligatorios"); return; }
  const lista = leer();
  lista.push(r);
  guardar(lista);
  render();
  alert("✅ Guardado localmente");
}

async function sincronizar() {
  const registros = leer();
  if (!registros.length) { alert("No hay registros."); return; }
  const params = new URLSearchParams();
  params.append("payload", JSON.stringify(registros));

  try {
    const resp = await fetch(SCRIPT_URL, { method:"POST", body:params });
    if (resp.ok) {
      localStorage.removeItem(STORAGE_KEY);
      render();
      alert("🚀 Sincronización completada.");
    } else {
      alert("❌ Error HTTP " + resp.status);
    }
  } catch(e) {
    alert("⚠️ Falló la sincronización: " + e.message);
  }
}

render();
</script>
</body>
</html>
